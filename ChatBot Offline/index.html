<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nancy AI â€” Premium Chat</title>
<style>
  :root{
    --glass: rgba(255,255,255,0.6);
    --accent:#3b82f6;
    --card-radius:20px;
    --muted:#7b8794;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}

  body{
    background: linear-gradient(180deg, #eef2f6 0%, #dfe6ec 100%);
    display:flex;align-items:center;justify-content:center;padding:32px;
    overflow:hidden;color:#111;
  }

  .scene{position:fixed;inset:0;z-index:0;pointer-events:none;}
  .scene canvas{width:100%;height:100%;display:block}

  .chat-wrap{position:relative;z-index:2;width:100%;max-width:800px;height:85vh;display:flex;flex-direction:column;box-shadow:0 30px 60px rgba(2,6,23,0.08);border-radius:var(--card-radius);background:linear-gradient(180deg, rgba(255,255,255,0.75), rgba(250,250,250,0.7));overflow:hidden}

  .chat-top{display:flex;align-items:center;padding:18px 20px;border-bottom:1px solid rgba(2,6,23,0.04);gap:12px;background:rgba(255,255,255,0.8)}
  .avatar{width:50px;height:50px;border-radius:12px;background:linear-gradient(135deg,#fff,#f1f5f9);display:flex;align-items:center;justify-content:center;font-weight:700;color:#0f1724;border:1px solid rgba(15,23,36,0.04)}
  .chat-title h2{margin:0;font-size:1.05rem}
  .chat-title p{margin:0;font-size:0.85rem;color:var(--muted)}

  .messages{flex:1;padding:20px;display:flex;flex-direction:column;gap:12px;overflow:auto;background:linear-gradient(180deg, transparent, rgba(255,255,255,0.4));}
  .bubble{max-width:78%;padding:12px 14px;border-radius:14px;line-height:1.4;font-size:0.95rem;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
  .bubble.user{margin-left:auto;border-bottom-right-radius:6px;background:linear-gradient(135deg,var(--accent),#2563eb);color:white}
  .bubble.bot{margin-right:auto;background:linear-gradient(180deg,#ffffff,#f8fafc);border:1px solid rgba(2,6,23,0.03);color:#0f1724}

  .typing{display:inline-flex;gap:6px;align-items:center}
  .typing .dot{width:8px;height:8px;border-radius:50%;background:#cbd5e1;animation:bl 1.4s infinite}
  @keyframes bl{0%{opacity:.2}40%{opacity:1}100%{opacity:.2}}

  .chat-input{display:flex;gap:12px;padding:14px;border-top:1px solid rgba(2,6,23,0.04);align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.6))}
  .input-box{flex:1;background:white;padding:10px 12px;border-radius:12px;border:1px solid rgba(2,6,23,0.04);display:flex;gap:8px;align-items:center}
  .input-box input{flex:1;border:0;outline:none;font-size:0.95rem}
  .icon-btn{width:44px;height:44px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;border:0;background:linear-gradient(135deg,var(--accent),#2b6cb0);color:white;cursor:pointer}
</style>
</head>
<body>
  <div class="scene"><canvas id="bgCanvas"></canvas></div>

  <section class="chat-wrap">
    <div class="chat-top">
      <div class="avatar">N</div>
      <div class="chat-title">
        <h2>Nancy â€” your assistant</h2>
        <p id="subTxt">Connecting...</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <button id="clearBtn" class="icon-btn" title="Clear">âœ–</button>
      </div>
    </div>

    <div id="messages" class="messages"></div>

    <div class="chat-input">
      <div class="input-box">
        <input id="input" placeholder="Type a message..." />
        <div id="typingIndicator" style="display:none" class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
      </div>
      <button id="mic" class="icon-btn" title="Voice">ðŸŽ¤</button>
      <button id="send" class="icon-btn" title="Send">âž¤</button>
    </div>
  </section>

<script>
// Background animation
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let w=canvas.width=innerWidth, h=canvas.height=innerHeight;
const nodes=[];const NODE_COUNT=Math.floor((w*h)/90000);
for(let i=0;i<NODE_COUNT;i++){nodes.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-0.5)*0.4,vy:(Math.random()-0.5)*0.4,r:1+Math.random()*2})}
window.addEventListener('resize',()=>{w=canvas.width=innerWidth;h=canvas.height=innerHeight});
function tick(){ctx.clearRect(0,0,w,h);for(let i=0;i<nodes.length;i++){const n=nodes[i];n.x+=n.vx;n.y+=n.vy;if(n.x<0||n.x>w)n.vx*=-1;if(n.y<0||n.y>h)n.vy*=-1;ctx.beginPath();ctx.arc(n.x,n.y,n.r,0,Math.PI*2);ctx.fillStyle='rgba(100,116,139,0.45)';ctx.fill();}for(let i=0;i<nodes.length;i++){for(let j=i+1;j<nodes.length;j++){const a=nodes[i],b=nodes[j];const dx=a.x-b.x,dy=a.y-b.y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<120){ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.strokeStyle='rgba(59,130,246,'+(0.12-(dist/120)*0.09)+')';ctx.lineWidth=1;ctx.stroke();}}}requestAnimationFrame(tick);}tick();

// Chat
const messages=document.getElementById('messages');
const input=document.getElementById('input');
const send=document.getElementById('send');
const typingIndicator=document.getElementById('typingIndicator');

function addBubble(text,cls='bot'){
  const d=document.createElement('div');
  d.className='bubble '+(cls==='user'?'user':'bot');
  d.innerText=text;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}

let ws=null;const WS_URL='ws://localhost:8765';
function connect(){
  try{
    ws=new WebSocket(WS_URL);
    ws.onopen=()=>{document.getElementById('subTxt').innerText='Connected'};
    ws.onmessage=(ev)=>{
      try{const d=JSON.parse(ev.data);
        if(d.type==='assistant'){typingIndicator.style.display='none';addBubble('Nancy: '+d.text,'bot');}
        else if(d.type==='user'){/* skip echo to avoid double message */}
        else{addBubble(d.text,'bot');}
      }catch(e){addBubble(ev.data,'bot');}
    };
    ws.onclose=()=>{document.getElementById('subTxt').innerText='Disconnected';setTimeout(connect,2000)};
  }catch(e){document.getElementById('subTxt').innerText='Error';}
}
connect();

send.addEventListener('click',()=>{
  const txt=input.value.trim();
  if(!txt)return;
  addBubble('You: '+txt,'user');
  input.value='';
  if(ws&&ws.readyState===WebSocket.OPEN){
    typingIndicator.style.display='inline-flex';
    ws.send(JSON.stringify({type:'message',text:txt}));
  }else{
    addBubble('â— Nancy is offline.','bot');
  }
});

input.addEventListener('keydown',e=>{if(e.key==='Enter')send.click();});
document.getElementById('clearBtn').addEventListener('click',()=>{messages.innerHTML='';});
</script>
</body>
</html>